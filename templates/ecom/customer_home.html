<!DOCTYPE html>
{% extends 'ecom/customer_base.html' %}
{% load static %}
<head>

</head>
{% block content %}
<body>

    {% comment %} <!-- First Navbar with Logo, Profile, Cart, Favorite, and Notification Icons -->
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <div class="container">
            <a class="navbar-brand" href="#"><h6 style="color: #0073a8;">minium order value 3000!!!</h6></a>
            <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
                <ul class="navbar-nav">
                  <li class="nav-item"><a class="nav-link active-link" href="/afterlogin">home</a></li>
                  <li class="nav-item"><a class="nav-link" href="/my-order">trackorder</a></li>
                  <li class="nav-item"><a class="nav-link" href="/my-profile">profile</a></li>
                  <li class="nav-item"><a class="nav-link" href="/logout">logout</a></li>
                    <!-- <li class="nav-item"><a class="nav-link" href="#"><i class="fas fa-user"></i></a></li>
                    <li class="nav-item"><a class="nav-link" href="#"><i class="fas fa-shopping-cart"></i></a></li>
                    <li class="nav-item"><a class="nav-link" href="#"><i class="fas fa-heart"></i></a></li>
                    <li class="nav-item"><a class="nav-link" href="#"><i class="fas fa-bell"></i></a></li> -->
                </ul>
            </div>
        </div>
    </nav> {% endcomment %}

    <!-- Second Navbar with Address Dropdown, Category Dropdown, Search Bar, and Button -->
    {% comment %} <nav class="navbar navbar-expand-lg navbar-dark pt-0">
        <div class="container">
            <div class="navbar-collapse">
                <ul class="navbar-nav">
                  <a class="navbar-brand" href="#"><img src="https://i.postimg.cc/dV76HPPK/shriganesh.jpg" alt="Logo" class="imgwidth"></a>                  
                </ul>
                <form class="form-inline mx-auto">
                  <div class="input-group">
                      <input class="form-control mr-sm-2" type="search" placeholder="Search" aria-label="Search">
                      <div class="input-group-append">
                          <button class="btn btnsearchcolor my-2 my-sm-0" type="submit"><i class="fas fa-search"></i></button>
                      </div>
                  </div>
              </form>
                <a href="/cart" class="btn  btnsearchcolor cartclr my-2 my-sm-0 ml-2"><i class="fas fa-shopping-cart"></i> Cart 
                  {%if product_count_in_cart > 0 %}
                  <span class="cartcount">{{ product_count_in_cart }}</span>
                  {%endif%}
                </a>
            </div>
        </div>
    </nav> {% endcomment %}
    <!-- Bootstrap Carousel Slider -->
    <div id="animation-container">
      <div id="carouselExample" class="carousel slide carosuelmargin" data-ride="carousel">
        <div class="carousel-inner carosuelinnerheight">
            <div class="carousel-item active">
                <img src="static/images/ecom-banner1.jpg" class="d-block w-100" alt="Slide 1">
            </div>
            <div class="carousel-item">
                <img src="static/images/ecom-banner1.png" class="d-block w-100" alt="Slide 2">
            </div>
            <div class="carousel-item">
                <img src="static/images/ecom-banner3.JPG" class="d-block w-100" alt="Slide 3">
            </div>
            <div class="carousel-item">
                <img src="static/images/ecom-banner4.jpg" class="d-block w-100" alt="Slide 4">
            </div>
            <div class="carousel-item">
                <img src="static/images/ecom-banner1.jpg" class="d-block w-100" alt="Slide 5">
            </div>
            <div class="carousel-item">
              <img src="static/images/ecom-banner1.png" class="d-block w-100" alt="Slide 6">
            </div>
            <div class="carousel-item">
              <img src="static/images/ecom-banner3.JPG" class="d-block w-100" alt="Slide 7">
            </div>
        </div>
        <a class="carousel-control-prev" href="#carouselExample" role="button" data-slide="prev">
            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            <span class="sr-only">Previous</span>
        </a>
        <a class="carousel-control-next" href="#carouselExample" role="button" data-slide="next">
            <span class="carousel-control-next-icon" aria-hidden="true"></span>
            <span class="sr-only">Next</span>
        </a>
    </div>

  {% comment %} <h3 style="text-align:center; color:#3E454C;">{{word}}</h3> {% endcomment %}
  <br>
  
  <!-- products data start -->
  <div class="container">
    <div class="gridlist-container">
      <div class="header">
        <script src="http://asvd.github.io/dragscroll/dragscroll.js"></script>
          <div class="scroll horizontal dragscroll">
            {%  for item in category %}
            <a href="javascript:void(0);"  scroll-trigger="section{{item.id}}" class="imgt cat-text">{{item.category_name}}</a>
            {% endfor %}
          </div>
        <i class="gridlist-listview on cursor-pointer btn-list"><i class="fa fa-bars list-grid-ico"></i></i>
        <i class="gridlist-gridview cursor-pointer btn-grid"><i class="fa fa-th list-grid-ico"></i></i>
      </div>
    </div>
  </div>

<!-- products data end -->
{% for data in context.products_data %}
<div class="container grid-container" scroll-target="section{{data.category_id}}">
  {%if query == ""%}
  <div class="headerhifne">
    <h2 class="animate-charcter">{{data.category_name}}</h2>
  </div>
  {%endif%}
  <div class="row animation-element bounce-up cf">
    {% for product in data.productsss %}
    <div class="col-12 col-md-6 col-lg-4">
      <div class="card subject development">
        <img class="card-img-top" src="{% static product.product_image.url %}" alt="">
        <div class="card-body">
          <p class="price-font">  <del>
            <span class="amount">₹ {{product.price}}</span>
          </del> 
          <span class="ml10 getamt{{product.id}}" id="{{product.finalprice}}">₹ <span class="change-val{{product.id}}">{{product.finalprice}}</span></span> </p>
          <h5 class="card-title cardtit mb-2">{{product.name}}</h5>
          {% comment %} <p class="card-text pb-2">{{product.description}}</p> {% endcomment %}
          <div class="d-flex justify-content-between align-items-center">
            <div class="qty-container">
              <button class="qty-btn-minus btn-light plusminus" id="{{product.id}}" type="button"><i class="fa fa-minus plusic"></i></button>
              <input type="hidden" class="amount{{product.id}}" value="{{product.finalprice}}">
              <input type="text" name="qty" value="1" min="1" class="input-qty plus-minus-input quantity{{product.id}}" disabled/>
              <button class="qty-btn-plus btn-light plusminus" id="{{product.id}}" type="button"><i class="fa fa-plus plusic"></i></button>
            </div>
              <button class="btn btnsearchcolor" onclick="addtocart({{product.id}})">Add to Cart</button>
          </div>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
</div>
{% endfor %}

    </div>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script> 
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
<script src="https://kit.fontawesome.com/your-fontawesome-kit.js"></script>

<script>
  (function($) { 
    $(function() { 
  
      //  open and close nav 
      $('#navbar-toggle').click(function() {
        $('.mobnav ul').slideToggle();
      });
  
  
      // Hamburger toggle
      $('#navbar-toggle').on('click', function() {
        this.classList.toggle('active');
      });
  
  
      // If a link has a dropdown, add sub menu toggle.
      $('.mobnav ul li a:not(:only-child)').click(function(e) {
        $(this).siblings('.navbar-dropdown').slideToggle("slow");
  
        // Close dropdown when select another dropdown
        $('.navbar-dropdown').not($(this).siblings()).hide("slow");
        e.stopPropagation();
      });
  
  
      // Click outside the dropdown will remove the dropdown class
      $('html').click(function() {
        $('.navbar-dropdown').hide();
      });
    }); 
  })(jQuery); 
    {%if messages %}
    {%for message in messages%}
    alert('{{message}}');
    {%endfor%}
    {%endif%}

    var $gridlistItem = $('.item');

    //open and close item when clicked on name
    $gridlistItem.find(".activator").click(function() {
        var $self = $(this).closest('.item');

        if ($self.hasClass("is-collapsed")) {
            $gridlistItem.not($self).removeClass("is-expanded").addClass("is-collapsed").addClass("is-inactive");
            $self.removeClass("is-collapsed").addClass("is-expanded");

            if ($gridlistItem.not($self).hasClass("is-inactive")) {
                //do nothing
            } else {
                $gridlistItem.not($self).addClass("is-inactive");
            }
        } else {
            $self.removeClass("is-expanded").addClass("is-collapsed");
            $gridlistItem.not($self).removeClass("is-inactive");
        }
    });

    //close card when click on cross
    $gridlistItem.find(".js-collapser").click(function() {
        var $self = $(this).closest(".item");
        $self.removeClass("is-expanded").addClass("is-collapsed");
        $gridlistItem.not($self).removeClass("is-inactive");
    });

    // -----------------------
    var container = $(".gridlist");
    var listButton = $(".gridlist-listview");
    var gridButton = $(".gridlist-gridview");

    listButton.on("click", function() {
        gridButton.removeClass("on");
        listButton.addClass("on");
        container.removeClass("gridview").addClass("listview");
    });

    gridButton.on("click", function() {
        listButton.removeClass("on");
        gridButton.addClass("on");
        container.removeClass("listview").addClass("gridview");
    });

    // -----------------------
    $('#FilterGridList').keyup(function(){

        var searchTerm = $(this).val().toLowerCase();
        var items = $('.gridlist > .item');
        var totalItems = items.length;

        items.each(function(){
            var txt = $(this).find('.item-content .subhead-1').text().toLowerCase(),
                 showItem = txt.indexOf(searchTerm) !== -1;

            $(this).toggle(showItem);
        });   

        var hiddenItems = $('.gridlist > .item:hidden').length;

        if(hiddenItems === totalItems){
            //$('.empty-data').show();
        }else{
            //$('.empty-data').hide();
        }
    });

    $(document).ready(function() {
        var scrollTrigger= $("*[scroll-trigger]");
        scrollTrigger.bind('click', function(e) {
            e.preventDefault(); // prevent hard jump, the default behavior
            var _this = $(this); 
            var triggerAttr = _this.attr('scroll-trigger'); 
            var scrollTarget = $('*[scroll-target='+triggerAttr+']');  // Set the target as variable

            // perform animated scrolling by getting top-position of target-element and set it as scroll target
            $('html, body').stop().animate({
                scrollTop: scrollTarget.offset().top - 0
            }, 600 );
            return false;
        });   
    });

    var buttonPlus  = $(".qty-btn-plus");
    var buttonMinus = $(".qty-btn-minus");

    var incrementPlus = buttonPlus.click(function() {
        var $n = $(this)
        .parent(".qty-container")
        .find(".input-qty");
        var getid = $(this).attr('id');
        var amt = $('.getamt'+getid).attr('id');
        $n.val(Number($n.val())+1);
        var numm = Number($n.val());
        $('.change-val'+getid).text(numm * amt +".00");
    });

    var incrementMinus = buttonMinus.click(function() {
        var $n = $(this)
        .parent(".qty-container")
        .find(".input-qty");
        var amount = Number($n.val());
        var getid = $(this).attr('id');
        var amt = $('.getamt'+getid).attr('id');
        var ddd = amount - 1;
        if (ddd == 0)
        {
            return false;
        }
        else
        {
            var numm = Number($n.val());
            $n.val(Number($n.val())-1);
            $('.change-val'+getid).text(numm * amt +".00");
        }
    });

    function addtocart(id) {
      var amounttt = $('.amount' + id).val();
      var quantityyy = $('.quantity' + id).val();
      var csrfToken = $('meta[name="csrf-token"]').attr('content');
      var postData = {
          product_id: id,
          price: Math.floor(amounttt),
          quantity: quantityyy
      };
      var url = '/add_to_cart';
    
      // Sending the POST request using $.ajax()
      $.ajax({
          type: 'POST',
          url: url,
          data: postData,
          headers: {
              'X-CSRFToken': csrfToken // Include CSRF token in the headers
          },
          success: function (response) {
            $('.cartcnt').text(response.count);
            console.log(response.message);
            alert(response.message);
          }
      });
    }

    $(document).ready(function(){
      $('.btn-grid').on('click', function(){
        $('.grid-container').removeClass('list-view');
      });
  
      $('.btn-list').on('click', function(){
        $('.grid-container').addClass('list-view');
      });
    });

    var $animation_elements = $('.animation-element');
var $window = $(window);

function check_if_in_view() {
  var window_height = $window.height();
  var window_top_position = $window.scrollTop();
  var window_bottom_position = (window_top_position + window_height);

  $.each($animation_elements, function() {
    var $element = $(this);
    var element_height = $element.outerHeight();
    var element_top_position = $element.offset().top;
    var element_bottom_position = (element_top_position + element_height);

    //check to see if this current container is within viewport
    if ((element_bottom_position >= window_top_position) &&
      (element_top_position <= window_bottom_position)) {
      $element.addClass('in-view');
    } else {
      $element.removeClass('in-view');
    }
  });
}

$window.on('scroll resize', check_if_in_view);
$window.trigger('scroll');
</script>

<script>
  // Function to check if an element is in the viewport
  function isElementInViewport(el) {
      var rect = el.getBoundingClientRect();
      return (
          rect.top >= 0 &&
          rect.left >= 0 &&
          rect.bottom <= (window.innerHeight || document.documentElement.clientHeight) &&
          rect.right <= (window.innerWidth || document.documentElement.clientWidth)
      );
  }

  // Function to trigger animations when elements come into view
  function checkAnimation() {
      var animationElements = document.querySelectorAll('.animation-element');

      animationElements.forEach(function(element) {
          if (isElementInViewport(element)) {
              element.classList.add('in-view');
          } else {
              element.classList.remove('in-view');
          }
      });
  }

  // Event listener for scrolling
  window.addEventListener('scroll', checkAnimation);
  window.addEventListener('resize', checkAnimation);

  // Initial check when the page loads
  checkAnimation();
</script>

{% endblock content %}
